// Generated by CoffeeScript 1.6.1

define(function(require, exports, module) {
  var $, Mustache, dialog, prefix, tpl, _;
  $ = require("bootstrap");
  _ = require("underscore");
  Mustache = require("mustache");
  tpl = require("./tpl/dialog.tpl");
  prefix = "zonda-util";
  dialog = function(config) {
    var dialog_html;
    dialog.config = config;
    if ($("#" + prefix + "-dialog:visible")[0]) {
      return false;
    }
    dialog_html = Mustache.render(tpl, {
      title: config.title,
      content: config.content
    });
    $(document.body).append(dialog_html);
    if (config.css) {
      $("#" + prefix + "-dialog").css(config.css);
    }
    _.each(config.button, function(button_callback, button_name) {
      var uid;
      uid = _.uniqueId("" + prefix + "-dialog-button-");
      $("#" + prefix + "-dialog .modal-footer").append("<button id=\"" + uid + "\" class=\"btn btn-success\">\n  " + button_name + "\n</button>");
      return $("#" + uid).click(button_callback);
    });
    dialog.dom = $("#" + prefix + "-dialog");
    $("#" + prefix + "-dialog").on("hide", function() {
      delete $("#" + prefix + "-dialog").modal;
      return $("#" + prefix + "-dialog").remove();
    });
    return dialog;
  };
  dialog.open = function() {
    var outerHeight;
    $("#" + prefix + "-dialog .modal-body").css({
      "max-height": window.innerHeight - 141
    });
    outerHeight = $("#" + prefix + "-dialog").outerHeight();
    $("#" + prefix + "-dialog").css({
      "margin-top": -outerHeight / 2
    });
    $("#" + prefix + "-dialog").modal({
      show: true,
      backdrop: dialog.config.backdrop
    });
    return dialog;
  };
  dialog.close = function(delay) {
    if (delay) {
      setTimeout(function() {
        return $("#" + prefix + "-dialog").modal("hide");
      }, delay);
    } else {
      $("#" + prefix + "-dialog").modal("hide");
    }
    return dialog;
  };
  return module.exports = dialog;
});
