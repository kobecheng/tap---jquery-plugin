// Generated by CoffeeScript 1.6.1
var fs, main, path;

fs = require("fs");

path = require("path");

main = function(dir, callback, depth) {
  var cell, list, tmp_list, _i, _j, _len, _len1, _results;
  if (depth <= 0) {
    false;
  }
  list = [];
  if (dir.realpath !== void 0) {
    list = fs.readdirSync(dir.realpath);
  } else {
    list = fs.readdirSync(dir);
  }
  tmp_list = [];
  for (_i = 0, _len = list.length; _i < _len; _i++) {
    cell = list[_i];
    if (/.~$/.test(cell)) {
      continue;
    }
    if (/.swp$/.test(cell)) {
      continue;
    }
    if (/.swo$/.test(cell)) {
      continue;
    }
    tmp_list.push(cell);
  }
  list = tmp_list;
  try {
    _results = [];
    for (_j = 0, _len1 = list.length; _j < _len1; _j++) {
      cell = list[_j];
      cell = {
        realpath: fs.realpathSync("" + dir + "/" + cell),
        name: cell
      };
      if (fs.statSync(cell.realpath).isFile()) {
        _results.push(callback('file', cell, depth));
      } else {
        main(cell.realpath, callback, depth - 1);
        _results.push(callback('dir', cell, depth));
      }
    }
    return _results;
  } catch (err) {
    return console.dir(err);
  }
};

module.exports = main;
